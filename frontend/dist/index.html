<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Info</title>
    <link rel="icon" href="data:,">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 20px auto; 
            padding: 20px; 
            line-height: 1.6;
        }
        #json-output {
            white-space: pre-wrap;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            min-height: 100px;
        }
        .loading { color: #666; }
        .error { color: #d32f2f; }
        .ip-address {
            font-weight: bold;
            color: #1976d2;
        }
        .search-box {
            margin: 20px 0;
        }
        input[type="text"] {
            padding: 8px;
            width: 200px;
            margin-right: 10px;
        }
        button {
            padding: 8px 16px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #1565c0;
        }
    </style>
</head>
<body>
    <h1>IP Information</h1>
    <div class="search-box">
        <input type="text" id="ip-input" placeholder="Enter IP address">
        <button onclick="searchIP()">Search</button>
    </div>
    <div id="ip-address" class="ip-address"></div>
    <div id="json-output" class="loading">Loading IP information...</div>

    <script>
        async function fetchIPInfo(ip = '') {
            const jsonOutputDiv = document.getElementById('json-output');
            const ipAddressDiv = document.getElementById('ip-address');
            
            // Show loading state
            jsonOutputDiv.textContent = 'Loading...';
            jsonOutputDiv.className = 'loading';
            ipAddressDiv.textContent = '';
            
            try {
                // Build API URL
                let apiUrl = 'https://api.ispinfo.io/ip';
                if (ip) {
                    // If IP is provided, query that IP
                    apiUrl += `/${ip}`;
                }
                
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Show the queried IP
                const currentIP = data.ip || ip || 'Your IP';
                ipAddressDiv.textContent = `Showing information for: ${currentIP}`;
                
                // Show the full JSON response
                jsonOutputDiv.textContent = JSON.stringify(data, null, 2);
                jsonOutputDiv.className = '';
            } catch (error) {
                jsonOutputDiv.textContent = `Error: ${error.message}`;
                jsonOutputDiv.className = 'error';
                console.error('Error fetching data:', error);
            }
        }

        // Handle search button click
        function searchIP() {
            const ipInput = document.getElementById('ip-input').value.trim();
            if (ipInput) {
                // Update URL without page refresh
                window.history.pushState({}, '', `/${ipInput}`);
                document.title = `IP Info - ${ipInput}`;
                fetchIPInfo(ipInput);
            } else {
                // If search box is empty, go back to home
                window.history.pushState({}, '', '/');
                document.title = 'IP Info - My IP';
                fetchIPInfo();
            }
        }

        // Handle browser back/forward buttons
        window.onpopstate = function() {
            const path = window.location.pathname;
            if (path === '/') {
                document.title = 'IP Info - My IP';
                document.getElementById('ip-input').value = '';
                fetchIPInfo();
            } else {
                const ip = path.substring(1);
                document.getElementById('ip-input').value = ip;
                document.title = `IP Info - ${ip}`;
                fetchIPInfo(ip);
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const path = window.location.pathname;
            
            if (path === '/') {
                // When visiting the root path, get visitor's own IP info
                document.title = 'IP Info - My IP';
                fetchIPInfo();
            } else {
                // When visiting /<ip>, get info for the specified IP
                const ip = path.substring(1);
                document.getElementById('ip-input').value = ip;
                document.title = `IP Info - ${ip}`;
                fetchIPInfo(ip);
            }
        });
    </script>
</body>
</html>
